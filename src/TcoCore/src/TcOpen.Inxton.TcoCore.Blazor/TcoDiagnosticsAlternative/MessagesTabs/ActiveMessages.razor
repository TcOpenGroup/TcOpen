@using MongoDB.Bson
@using TcOpen.Inxton.TcoCore.Blazor.TcoDiagnosticsAlternative.Mapping
@using global::TcoCore
@using BlazorStrap

<h3>ActiveMessages</h3>


<BSContainer>
  <BSRow class="d-flex align-items-center">
        <BSCol md="6">
            <BSInput InputType="InputType.Select" @bind-Value="@DropDownSelectedCategory">
                @foreach (var category in Enum.GetValues(typeof(eMessageCategory)))
                {
                    <option value="@category">@category</option>
                }
            </BSInput>
        </BSCol>
        <BSCol md="6">
            <BSLabel>Depth Value: @DepthValue</BSLabel>
            <BSInput InputType="InputType.Range" @bind-Value="DepthValue" min="1" max="@MaxDiagnosticsDepth" />
        </BSCol>
    </BSRow>



    <BSTable Striped Bordered Hover>
        <thead>
            <tr>
                <th>UTC Timestamp</th>
                <th>Timestamp Acknowledged</th>
                <th>Rendered Message</th>
                <th>Level</th>
                <th>Message Template Text</th>
                <th>Sender Parent Symbol</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            @if (_messagesToDisplay != null)
            {
                @foreach (var message in _messagesToDisplay)
                {
                    <tr>
                        <td>@message.UtcTimeStamp</td>
                        <td>@(message.TimeStampAcknowledged.HasValue ? message.TimeStampAcknowledged.Value.ToString("MM/dd/yyyy HH:mm:ss") : " ")</td>
                        <td>@message.RenderedMessage</td>
                        <td>@message.Level</td>
                        <td>@message.MessageTemplate?.Text</td>
                        <td>@message.Properties?.sender?.Payload?.ParentSymbol</td>
                        <button class="@(message.TimeStampAcknowledged.HasValue ? "disabled-button" : "")" @onclick="() => AcknowledgeMessage(message.Properties.ExtractedIdentity, message.Properties.sender.Payload.MessageDigest)">
                            Acknowledge
                        </button>
                    </tr>
                }
            }
        </tbody>
    </BSTable>
    <BSPagination Align="Align.Center" Pages="@_totalPages" @bind-Value="_currentPage" />
</BSContainer>
